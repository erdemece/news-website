{% extends "admin/base.twig" %}
{% block title %}Add Post{% endblock %}

{% block base_content %}
{% embed 'admin/menu.twig' %}{% endembed %}
{% embed 'admin/main.content.twig' with { title : block('title') } %}

  {% block main_content %}

    <div class="row">
      <div class="col-xs-12">
        <form class="form-horizontal" role="form" action="/en/admin/add-article" method="POST" enctype="multipart/form-data">

          <div class="form-group">
            <div class="col-sm-9">
              <label for="article-title">News Title</label>
              <input type="text" name="article-title" id="article-title" placeholder="Article Title" class="form-control" required/>
            </div>
          </div>

          <div class="form-group">

            <div class="col-xs-12 col-sm-6">
              <label for="article-category">Choose Category</label>
              <select multiple="" name="article-category[]" class="chosen-select form-control" id="article-category" data-placeholder="Choose a Category" required>
                {% for value in categoryNames %}
                <option value="{{value.category_id}}">{{value.category_name}}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-xs-12 col-sm-6">
              <label for="postPicture">Choose Date</label>
              <!-- #section:plugins/date-time.datetimepicker -->
              <div class="input-group">
                <input id="article-date" name="article-date" type="text" class="form-control" value="{{currentTime}}" />
                <span class="input-group-addon">
                  <i class="fa fa-clock-o bigger-110"></i>
                </span>
              </div>
            </div>
          </div>

          <div class="hr hr-double dotted"></div>

          <textarea name="article-content"></textarea>

          <div class="hr hr-double dotted"></div>

          <div class="form-group">

            <div class="col-xs-12 col-sm-4">
              <label for="article-image">Add Picture</label>
              <div class="form-group">
                <div class="col-xs-12">
                  <input type="file" name="article-image" id="article-image" />
                  <!-- <input multiple="" name="postPictureMulti[]" type="file" id="id-input-file-3" /> -->
                  <!-- /section:custom/file-input -->
                </div>
              </div>

            </div>

            <div class="col-xs-12 col-sm-4">
              <label for="article-tags">Add Tags</label>
              <div class="form-group">
                <div class="col-xs-12">
                  <input type="text" name="article-tags" id="article-tags" value="" placeholder="Enter tags ..." />
                  <!-- /section:plugins/input.tag-input -->
                </div>
              </div>
            </div>

            <div class="col-xs-12 col-sm-4">

              <div class="form-group" >

                <div class="col-xs-12 col-sm-6">

                  <div class="control-group">
                    <label class="control-label">Is Article</label>

                    <div class="radio">
                      <label>
                        <input name="is-article-active" type="radio" value="active" class="ace" />
                        <span class="lbl"> Active</span>
                      </label>
                    </div>

                    <div class="radio">
                      <label>
                        <input name="is-article-active" type="radio" value="draft" class="ace" />
                        <span class="lbl"> Draft</span>
                      </label>
                    </div>

                  </div>
                </div>

                <div class="col-xs-12 col-sm-6">

                  <div class="control-group">
                    <label class="control-label">Comments</label>

                    <div class="radio">
                      <label>
                        <input name="article-comment" type="radio" value="on" class="ace" />
                        <span class="lbl"> On</span>
                      </label>
                    </div>

                    <div class="radio">
                      <label>
                        <input name="article-comment" type="radio" value="off" class="ace" />
                        <span class="lbl"> Off</span>
                      </label>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>

          <div class="clearfix form-actions">

            <div class="col-md-offset-3 col-md-9">

              <input type="submit" class="btn btn-info" value="Submit">
              <button class="btn" type="reset">
                <i class="ace-icon fa fa-undo bigger-110"></i>
                Reset
              </button>

            </div>

          </div>
        </form>
      </div>
    </div>
  {% endblock %}
  {% endembed %}
{% endblock %}
{% block stylesheet %}
{{ parent() }}
<link rel="stylesheet" href="/skin/default/admin/css/jquery-ui.custom.css" />
<link rel="stylesheet" href="/skin/default/admin/css/chosen.css" />
<link rel="stylesheet" href="/skin/default/admin/css/bootstrap-datepicker3.css" />
<link rel="stylesheet" href="/skin/default/admin//css/bootstrap-timepicker.css" />
<link rel="stylesheet" href="/skin/default/admin/css/daterangepicker.css" />
<link rel="stylesheet" href="/skin/default/admin/css/bootstrap-datetimepicker.css" />
<link rel="stylesheet" href="/skin/default/admin/css/colorpicker.css" />
{% endblock %}
{% block javascript %}
{{ parent() }}
<script src="/skin/default/admin/js/jquery-ui.custom.js"></script>
<script src="/skin/default/admin/js/jquery.ui.touch-punch.js"></script>
<script src="/skin/default/admin/js/jquery.hotkeys.js"></script>
<script src="/skin/default/admin/js/tinymce/tinymce.min.js"></script>
<script src="/skin/default/admin/js/bootbox.js"></script>
<script src="/skin/default/admin/js/chosen.jquery.js"></script>
<script src="/skin/default/admin/js/fuelux/fuelux.spinner.js"></script>
<script src="/skin/default/admin/js/date-time/bootstrap-datepicker.js"></script>
<script src="/skin/default/admin/js/date-time/bootstrap-timepicker.js"></script>
<script src="/skin/default/admin/js/date-time/moment.js"></script>
<script src="/skin/default/admin/js/date-time/daterangepicker.js"></script>
<script src="/skin/default/admin/js/date-time/bootstrap-datetimepicker.js"></script>
<script src="/skin/default/admin/js/bootstrap-colorpicker.js"></script>
<script src="/skin/default/admin/js/jquery.knob.js"></script>
<script src="/skin/default/admin/js/autosize.js"></script>
<script src="/skin/default/admin/js/jquery.inputlimiter.1.3.1.js"></script>
<script src="/skin/default/admin/js/jquery.maskedinput.js"></script>
<script src="/skin/default/admin/js/bootstrap-tag.js"></script>
<script>
tinymce.init({
  selector: 'textarea',
  height: 500,
  theme: 'modern',
  plugins: [
    'advlist autolink lists link image charmap print preview hr anchor pagebreak',
    'searchreplace wordcount visualblocks visualchars code fullscreen',
    'insertdatetime media nonbreaking save table contextmenu directionality',
    'emoticons template paste textcolor colorpicker textpattern imagetools jbimages'
  ],
  toolbar1: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image jbimages',
  toolbar2: 'print preview media | forecolor backcolor emoticons',
  image_advtab: true,
  relative_urls: false
});
</script>

<script type="text/javascript">
  jQuery(function($) {
    $('#id-disable-check').on('click', function() {
      var inp = $('#form-input-readonly').get(0);
      if(inp.hasAttribute('disabled')) {
        inp.setAttribute('readonly' , 'true');
        inp.removeAttribute('disabled');
        inp.value="This text field is readonly!";
      }
      else {
        inp.setAttribute('disabled' , 'disabled');
        inp.removeAttribute('readonly');
        inp.value="This text field is disabled!";
      }
    });


    if(!ace.vars['touch']) {
      $('.chosen-select').chosen({allow_single_deselect:true});
      //resize the chosen on window resize

      $(window)
      .off('resize.chosen')
      .on('resize.chosen', function() {
        $('.chosen-select').each(function() {
           var $this = $(this);
           $this.next().css({'width': $this.parent().width()});
        })
      }).trigger('resize.chosen');
      //resize chosen on sidebar collapse/expand
      $(document).on('settings.ace.chosen', function(e, event_name, event_val) {
        if(event_name != 'sidebar_collapsed') return;
        $('.chosen-select').each(function() {
           var $this = $(this);
           $this.next().css({'width': $this.parent().width()});
        })
      });


      $('#chosen-multiple-style .btn').on('click', function(e){
        var target = $(this).find('input[type=radio]');
        var which = parseInt(target.val());
        if(which == 2) $('#article-category').addClass('tag-input-style');
         else $('#article-category').removeClass('tag-input-style');
      });
    }


    $('[data-rel=tooltip]').tooltip({container:'body'});
    $('[data-rel=popover]').popover({container:'body'});

    autosize($('textarea[class*=autosize]'));

    $('textarea.limited').inputlimiter({
      remText: '%n character%s remaining...',
      limitText: 'max allowed : %n.'
    });

    $.mask.definitions['~']='[+-]';
    $('.input-mask-date').mask('99/99/9999');
    $('.input-mask-phone').mask('(999) 999-9999');
    $('.input-mask-eyescript').mask('~9.99 ~9.99 999');
    $(".input-mask-product").mask("a*-999-a999",{placeholder:" ",completed:function(){alert("You typed the following: "+this.val());}});



    $( "#input-size-slider" ).css('width','200px').slider({
      value:1,
      range: "min",
      min: 1,
      max: 8,
      step: 1,
      slide: function( event, ui ) {
        var sizing = ['', 'input-sm', 'input-lg', 'input-mini', 'input-small', 'input-medium', 'input-large', 'input-xlarge', 'input-xxlarge'];
        var val = parseInt(ui.value);
        $('#form-field-4').attr('class', sizing[val]).val('.'+sizing[val]);
      }
    });

    $( "#input-span-slider" ).slider({
      value:1,
      range: "min",
      min: 1,
      max: 12,
      step: 1,
      slide: function( event, ui ) {
        var val = parseInt(ui.value);
        $('#form-field-5').attr('class', 'col-xs-'+val).val('.col-xs-'+val);
      }
    });

    $('#id-input-file-1 , #article-image').ace_file_input({
      no_file:'No File ...',
      btn_choose:'Choose',
      btn_change:'Change',
      droppable:false,
      onchange:null,
      thumbnail:false //| true | large
      //whitelist:'gif|png|jpg|jpeg'
      //blacklist:'exe|php'
      //onchange:''
      //
    });
    //pre-show a file name, for example a previously selected file
    //$('#id-input-file-1').ace_file_input('show_file_list', ['myfile.txt'])


    $('#id-input-file-3').ace_file_input({
      style: 'well',
      btn_choose: 'Drop image here or click to choose',
      btn_change: null,
      no_icon: 'ace-icon fa fa-cloud-upload',
      droppable: true,
      thumbnail: 'large'//large | fit
      //,icon_remove:null//set null, to hide remove/reset button
      /**,before_change:function(files, dropped) {
        //Check an example below
        //or examples/file-upload.html
        return true;
      }*/
      /**,before_remove : function() {
        return true;
      }*/
      ,
      preview_error : function(filename, error_code) {
        //name of the file that failed
        //error_code values
        //1 = 'FILE_LOAD_FAILED',
        //2 = 'IMAGE_LOAD_FAILED',
        //3 = 'THUMBNAIL_FAILED'
        //alert(error_code);
      }

    }).on('change', function(){
      //console.log($(this).data('ace_input_files'));
      //console.log($(this).data('ace_input_method'));
    });


    //$('#id-input-file-3')
    //.ace_file_input('show_file_list', [
      //{type: 'image', name: 'name of image', path: 'http://path/to/image/for/preview'},
      //{type: 'file', name: 'hello.txt'}
    //]);




    //dynamically change allowed formats by changing allowExt && allowMime function
    $('#id-file-format').removeAttr('checked').on('change', function() {
      var whitelist_ext, whitelist_mime;
      var btn_choose
      var no_icon
      if(this.checked) {
        btn_choose = "Drop images here or click to choose";
        no_icon = "ace-icon fa fa-picture-o";

        whitelist_ext = ["jpeg", "jpg", "png", "gif" , "bmp"];
        whitelist_mime = ["image/jpg", "image/jpeg", "image/png", "image/gif", "image/bmp"];
      }
      else {
        btn_choose = "Drop files here or click to choose";
        no_icon = "ace-icon fa fa-cloud-upload";

        whitelist_ext = null;//all extensions are acceptable
        whitelist_mime = null;//all mimes are acceptable
      }
      var file_input = $('#id-input-file-3');
      file_input
      .ace_file_input('update_settings',
      {
        'btn_choose': btn_choose,
        'no_icon': no_icon,
        'allowExt': whitelist_ext,
        'allowMime': whitelist_mime
      })
      file_input.ace_file_input('reset_input');

      file_input
      .off('file.error.ace')
      .on('file.error.ace', function(e, info) {
        //console.log(info.file_count);//number of selected files
        //console.log(info.invalid_count);//number of invalid files
        //console.log(info.error_list);//a list of errors in the following format

        //info.error_count['ext']
        //info.error_count['mime']
        //info.error_count['size']

        //info.error_list['ext']  = [list of file names with invalid extension]
        //info.error_list['mime'] = [list of file names with invalid mimetype]
        //info.error_list['size'] = [list of file names with invalid size]


        /**
        if( !info.dropped ) {
          //perhapse reset file field if files have been selected, and there are invalid files among them
          //when files are dropped, only valid files will be added to our file array
          e.preventDefault();//it will rest input
        }
        */


        //if files have been selected (not dropped), you can choose to reset input
        //because browser keeps all selected files anyway and this cannot be changed
        //we can only reset file field to become empty again
        //on any case you still should check files with your server side script
        //because any arbitrary file can be uploaded by user and it's not safe to rely on browser-side measures
      });


      /**
      file_input
      .off('file.preview.ace')
      .on('file.preview.ace', function(e, info) {
        console.log(info.file.width);
        console.log(info.file.height);
        e.preventDefault();//to prevent preview
      });
      */

    });

    $('#spinner1').ace_spinner({value:0,min:0,max:200,step:10, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
    .closest('.ace-spinner')
    .on('changed.fu.spinbox', function(){
      //console.log($('#spinner1').val())
    });
    $('#spinner2').ace_spinner({value:0,min:0,max:10000,step:100, touch_spinner: true, icon_up:'ace-icon fa fa-caret-up bigger-110', icon_down:'ace-icon fa fa-caret-down bigger-110'});
    $('#spinner3').ace_spinner({value:0,min:-100,max:100,step:10, on_sides: true, icon_up:'ace-icon fa fa-plus bigger-110', icon_down:'ace-icon fa fa-minus bigger-110', btn_up_class:'btn-success' , btn_down_class:'btn-danger'});
    $('#spinner4').ace_spinner({value:0,min:-100,max:100,step:10, on_sides: true, icon_up:'ace-icon fa fa-plus', icon_down:'ace-icon fa fa-minus', btn_up_class:'btn-purple' , btn_down_class:'btn-purple'});

    //$('#spinner1').ace_spinner('disable').ace_spinner('value', 11);
    //or
    //$('#spinner1').closest('.ace-spinner').spinner('disable').spinner('enable').spinner('value', 11);//disable, enable or change value
    //$('#spinner1').closest('.ace-spinner').spinner('value', 0);//reset to 0


    //datepicker plugin
    //link

    $('#timepicker1').timepicker({
      minuteStep: 1,
      showSeconds: true,
      showMeridian: false,
      disableFocus: true
    }).on('focus', function() {
      $('#timepicker1').timepicker('showWidget');
    }).next().on(ace.click_event, function(){
      $(this).prev().focus();
    });




    if(!ace.vars['old_ie']) $('#article-date').datetimepicker({
     format: 'DD/MM/YYYY H:mm A',//use this option to display seconds
     icons: {
      time: 'fa fa-clock-o',
      date: 'fa fa-calendar',
      up: 'fa fa-chevron-up',
      down: 'fa fa-chevron-down',
      previous: 'fa fa-chevron-left',
      next: 'fa fa-chevron-right',
      today: 'fa fa-arrows ',
      clear: 'fa fa-trash',
      close: 'fa fa-times'
     }
    }).next().on(ace.click_event, function(){
      $(this).prev().focus();
    });


    $(".knob").knob();


    var tag_input = $('#article-tags');
    try{
      tag_input.tag(
        {
        placeholder:tag_input.attr('placeholder'),
        //enable typeahead by specifying the source array
        //defined in ace.js >> ace.enable_search_ahead
        //or fetch data from database, fetch those that match "query"
        source: function (query, process) {

          return $.get('/en/admin/get-article-tags/' + query, function (data) {
              return process(parse(data).tag_keyword);
          });
        }
        }
      )

      //programmatically add/remove a tag
      var $tag_obj = $('#article-tags').data('tag');

      var index = $tag_obj.inValues('some tag');
      $tag_obj.remove(index);
    }
    catch(e) {
      //display a textarea for old IE, because it doesn't support this plugin or another one I tried!
      tag_input.after('<textarea id="'+tag_input.attr('id')+'" name="'+tag_input.attr('name')+'" rows="3">'+tag_input.val()+'</textarea>').remove();
      //autosize($('#article-tags'));
    }


    /////////
    $('#modal-form input[type=file]').ace_file_input({
      style:'well',
      btn_choose:'Drop files here or click to choose',
      btn_change:null,
      no_icon:'ace-icon fa fa-cloud-upload',
      droppable:true,
      thumbnail:'large'
    })

    //chosen plugin inside a modal will have a zero width because the select element is originally hidden
    //and its width cannot be determined.
    //so we set the width after modal is show
    $('#modal-form').on('shown.bs.modal', function () {
      if(!ace.vars['touch']) {
        $(this).find('.chosen-container').each(function(){
          $(this).find('a:first-child').css('width' , '210px');
          $(this).find('.chosen-drop').css('width' , '210px');
          $(this).find('.chosen-search input').css('width' , '200px');
        });
      }
    })
    /**
    //or you can activate the chosen plugin after modal is shown
    //this way select element becomes visible with dimensions and chosen works as expected
    $('#modal-form').on('shown', function () {
      $(this).find('.modal-chosen').chosen();
    })
    */



    $(document).one('ajaxloadstart.page', function(e) {
      autosize.destroy('textarea[class*=autosize]')

      $('.limiterBox,.autosizejs').remove();
      $('.daterangepicker.dropdown-menu,.colorpicker.dropdown-menu,.bootstrap-datetimepicker-widget.dropdown-menu').remove();
    });

  });
</script>
{% endblock %}
